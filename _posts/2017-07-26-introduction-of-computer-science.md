---
layout: post
title: "计算机相关技术瞎扯"
description: ""
keywords: computer
category: Programming
tags: [computer]
---

# 前言

试图用通俗的语言聊一聊计算机的相关知识体系，尽可能把重点脉络和原理讲清楚，当然不可能面面俱到，也可能会用到不太准确但更通俗的说法。

# 计算机程序如何执行
## 高低电平映射到01序列，01序列映射到其他
计算机从硬件的角度来看只懂得0和1（高电平、低电平），
然后通过**与非门**等逻辑电路组成更复杂的支持加法或者乘法的运算单元，进行运算，

例如打个比方八根排线，假设0为低电平，1为高电平，`0000 0001`这个最右边的排线假设赋予其一个数字1的含义，
`0000 0010`这个右二为高电平的排序赋予数字2的含义（排线的高低电平 映射到 01序列 映射到 我们认识的整数），
那么`0000 0001`这个电信号与`0000 0010`这个电信号输入到
由 **与非门电路** 组合而成的加法运算器中后，输出排线的电平为`0000 0011`于是得到数字3，
这里将`0000 0010`与2对应，以及其他对应整型数的方式比较流行的是补码，
补码流行的原因是对正数、负数的累加都一样，就不用为了正数、负数单独设计累加器。

除了与非门构成的运算结构，还需要保存一些中间运算结果，硬件名字不记得了，总之是能贮存电平的单元，
运算和贮存，这几乎就是组成计算机的硬件的最基本的原理构架了。

## 01序列映射的其他例子

因为计算机只懂得高电平，低电平，或者说01序列，实际上，我们需要用01序列去表示所有需要的东西，

首先是整型数字，也就是补码，也就是一种01序列映射到整型的一个函数。

然后是字符串，最著名的是[ASCII](https://baike.baidu.com/item/ASCII/309296?fr=aladdin)编码，
例如将65(实际上对计算机而言是 `0100 0001`，65只是人比较好理解的十进制)映射为字母`A`，
所以当计算机看到`0100 0001`时，并且告诉计算机将其理解为ASCII字符时，计算机将其解读为字符`A`并执行接下来的操作，例如打印到屏幕上
（实际上是存储到某个特定的用于显示的内存区间）。
ASCII缺点在于位数太低，不能涵盖中日韩等字符，于是出现了unicode、UTF-8编码等，实际上就是对01序列不同的映射到字符的方式。

然后是浮点数来表示小数，通常采用IEEE-754标准。

而计算机的执行指令，也就是控制计算机对某个数字进行加法、乘法等运算的机器命令，**也是01序列**，
其映射规则称为指令集，
例如[x86指令集](http://blog.csdn.net/liuzhen917/article/details/30465891)，也比较流行的是arm构架指令集。
这些指令集都有对应的，最原始的人可以读懂的方式，称为汇编语言。
注意到不同的机器，如果其指令集不一样，其汇编语言也不一样。

## 计算机如何运算

1. **取指**: 从指令的排线中，读取某一段指令序列。
2. **译码**: 判断要执行的操作，如果需要对数据进行运算还要从数据排线中读取数据（称为操作数）
3. **运算**: 执行运算，将输入数据输入到运算单元
4. **回写**: 保存运算后的数据，将其存到例如内存或者寄存器等地方

然后读取下一段指令序列，不断循环以上四个步骤。
至于下一段指令在哪里，是将指令的位置(地址，对应于C语言的指针)存放到曾为PC寄存器的位置，
每次通过读取PC寄存器，来找到下一段指令的门牌号（地址），执行取指、译码、运算、回写这四个步骤。
通常情况下PC寄存器是按01指令序列的顺序进行读写，但是也有跳转，例如对于C语言的循环或者函数调用就是跳转，
也就是设定PC寄存器内的值，使得下一个执行序列跳转到预期的地方。

这些操作需要保证一定的时序性，因为都共用了同一个数据线，否则后面的信号可能跟前面的信号弄混了，
所以为了保证其时序性，加入一个 *...高低高低高低...* 这样脉动变化的信号作为同步的时钟，
通常说的CPU I5有3.5 GHz 也即是说的这个时钟的频率。

# 计算机语言
计算机只懂得0和1，控制计算机，也就是构成计算机能够执行的正确的01序列，如上所说的x86、ARM等指令集，
这些指令集的文本表示称为汇编语言，也就是最接近计算机指令，同时又映射成人可以读懂的语言。
**汇编语言即使类似与x86这样的机器码的文本表示**，对应人可以读懂的，机器的执行命令，
这些命令绝大多数都是赋值、运算、根据条件跳转这样的机器**可以做**的事情。

但不同机器设计的汇编语言不一样，这样在一台机器上编写的代码，就不能在另外一台机器上跑，
尤其对于早期各类机器而言。

这时出现了一个对汇编语言的执行的某种通用的归纳（抽象），称为C语言，
这样机器虽然不同，但通过C语言的编译器编译成针对这台机器的汇编代码，再编译成机器执行指令的01序列就可以控制机器了。
C语言的最大贡献是对汇编语言执行结构的合理的抽象，同时又方便更高层次地思考问题，而不用太细化到机器指令这一层面，
例如循环结构，对应机器指令而言就是条件跳转，符合某个条件（例如某个数大于0），
就通过改变PC寄存器的值跳到当前执行序列前的某个地方，重复执行这一段01序列。

这样不同的机器都可以共用同一份代码，只要该机器上有C语言编译器就能执行，
通过C语言对汇编语言的抽象，这样就从需要考虑机器编码这一硬件执行过程的苦力中解脱出来，
只需要考虑逻辑问题。
所以总的来说C语言是对汇编的一层抽象，最接近汇编语言，所以执行效率很高且常用于系统编程。

稍微总结一下，所谓编程语言，就是人与机器之间交流的中间语言，我们看到的各种语言都是文本表示，
机器看得懂的是01序列，编译器（例如vc）就是将我们看得懂的文本语言翻译成机器看得懂的01序列。

编译器就是一个翻译官，读某种语言的源代码，理解其内容，映射到目标语言中。
目标语言不仅仅是01序列，也可以是其他，例如将C语言翻译成Fortran语言也可以。
例如本文的撰写格式采用的是markdown语法，通过某个翻译器（不专业的说法），
最终会转化成html格式，然后浏览器理解这段html格式，将其按照内容中的要求将内容显示在显示器上。
这里浏览器实际上是一个**解释器**，不同于**编译器**这样将一段程序翻译成01执行序列或者另一种程序的方式。
浏览器这样的解释器是理解html格式，然后按照其要求执行浏览器程序自己设定的01序列，
html并没有被翻译成01序列，而是通过浏览器代理执行，或者说浏览器成了一个可以理解更高级内容的**虚拟机**。

稍微跑一下题，进一步说，很多程序就是一个理解某个规则的片段并执行的过程，例如excel可以理解的csv文本格式如下:

```csv
Time,H2,CO,CH4,case_example,stages
0.05556,23.35235,3.10185,8.68601,case1,C1S1
0.11111,23.62906,3.55692,7.60854,case1,C1S1
0.16667,24.64287,3.62913,7.69976,case1,C1S1
0.22222,29.64828,5.03771,7.87253,case1,C1S1
0.27778,31.87434,4.77112,7.90599,case1,C1S1
0.33333,32.39345,4.02943,7.54947,case1,C1S1
0.38889,31.42271,3.50293,6.47658,case1,C1S1
0.44444,30.96054,4.52849,6.69443,case1,C1S1
```

就是解析表格内容，由逗号分割不同列，由回车符分割不同行。
这就是csv定义的读取数据的规则或者说语法。
假设Fluent生成的文件不符合tecplot的语法规则，那么tecplot的程序就读不懂Fluent生成的内容。

回到正题，不同的语言有的更接近人，有的更接近机器，例如汇编语言最接近机器，人看汇编语言就会很繁琐，
，例如一个函数调用，在C语言里看很容易一眼看懂，对应到机器码就会看着有些累，编写一个函数调用的机器码更累。
这就带来了编写效率的问题，
早期的语言例如Fortran语言是为了解决机器的执行效率问题，其语法特点方便优化，方便数值计算，
但从现在的角度来说，对人不太友好，例如其函数通常有非常多个参数，且命名很难读懂，
变量作用范围没有加以限制，某个地方出错了可能要找很远才发现问题，很容易出错。
现在的硬件条件已经很丰富了，绝大多数现代语言都是解决人的编写效率问题，

这里有一个问题，有没有执行效率高，同时人编写代码效率高的编程语言呢？
我个人认为，由于机器执行逻辑与人遇到的真实现实问题的差异导致很难实现。
执行效率高意味着对机器的精确控制，而代码编写效率高的一个方面就是尽可能减少考虑细节问题的负担，
而将精力放在现实问题上。

C++想要成为a better C，提供C没有的一些能力，例如对象、模板等，同时尽可能考虑不降低性能损失，
（当然，面向对象的设计风格，C也可以通过函数指针变相地实现，只是会麻烦一点）
可以简单的理解C++是C的超集，目的是让人更有效率地的进行机器底层的开发。
因此现代操作系统、游戏引擎、机器学习后端引擎、数值模拟软件等需要与具体机器打交道、需要考虑性能调优的场景
多采用C++开发。

需要说明的是C++注重于开发效率与优化，添加了模板元编程、面向对象等多个范式，因此不可避免地其语法复杂度较高，
也有各种语法的坑，容易出现一些其他高级语言不会出现的一些意想不到的错误，
所以需要了解其各种坑和细节，我差不多死磕C++一年半，也只能说稍微理解一点其面向对象的内容，
很多编程十年的也不敢说精通C++，其创始人也不敢说完全懂C++，
这些细节和坑对于初步学习编程并没有什么用，所以并不是一个初学编程的好选择。

另外，C++注重效率意味着其编译器设计也很复杂，对于较小的单片机之类的程序而言，其生成的代码可能会有些臃肿，
因此类似单片机之类的小型机器多采用C语言。

